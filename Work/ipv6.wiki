ipv4--->ipv6需要修改的协议：
	- 链路层：以太网相对修改较小，IPv6 协议号0x86DD ，比较大的修改部分应该
	  是为MTU发现
	- 处理；对于ATM网络可能修改量较大
	- ARP/RARP：需要支持v6地址到MAC的变换
	- 网络层：ICMPv4需要升级为ICMPv6, IGMP也需要升级
	- 传输层：需要网络层信息的所有协议都必须修改，如TCP/UDP 的校验和计算都
	  用到了IP伪头信息
	- 应用层：所有使用IP地址信息的协议都需要修改，特别是有子连接的协议
	- 路由协议：RIP、OSPF、…全部需要更新
	- 文本地址表示协议：如FTP、SIP等，修改相对简单
	- 数值地址表示协议：如DNS、DHCP、BOOTP、H.323等，修改相对复杂
	- 用户界面：要支持IPv6地址格式
	- 简化部分：IPSec，在IPv6中实现IPSec相对比较简单，因为在设计IPv6时就把
	  IPSec 作为一个部分考虑进去了，而设计IPv4时根本还不存在IPSec概念，IPS
	  ec是后来硬塞进IPv4中的。

在IPv6协议中不在使用广播这个概念，取而代之的是IPv6组播。IPv6提供了大量的组播地
址，因此组播地址的分配不像IPv4一样由于数量稀少儿受限：同时,IPv6 协议在组播地址
中增加了一个“Scope”域，提高了组播路由的可扩展性。另外，除了组播与单播地址，IPv
6协议定义了一种新的地址类型，称为任播（Anycast）地址，其被定义为一组网络接口（
通常属于不同节点）的标识，发往一个任播地址的分组将被转发到由该地址标识的“最近”
的一个网络接口，而“最近”的定义一般基于路由协议中的距离度量。

地址自动配置功能也是IPv6寻址构架中的一个重要特征。IPv6网络设备可以自动发现所属
的网络并且获取全球唯一的地址，免去了人工配置或服务其配置（如DHCP服务器）的负担
实现了网络设备在网络中的即插即用。

报头格式的简化：
	虽然IPv6地址长度的增加导致了整个IPv6报头长度的增加，但IPv6报头格式相对
于IPv4来说大大简化了。IPv4基本头部大小为20字节，但IP选项域长度可变，增加了路由
器对报头例行处理的开销。相反，IPv6头部大小为固定的40字节，它舍弃了IPv4报头12个
字段中的6 个，并将一些字段改名后保留，同时增加了一些新的字段以提高效率并引入新
特性。

ipv4:
	0		1		2		3		4
1.	版本4	|头长4	|	服务类型8|		总长度16	|
2.		标识符16		 |标志3|	偏移量13	|
3.	生存时间TTL8   	|        协议8	 |	检验和16		|
4.				源IP地址32				|
5.				目的IP地址32				|
6.				选项（如果有）				 

ipv6:
	0		1		2		3		4
1.	版本4	|class 4|	flow label 24				|
2.	     payload length16		|nexthdr	|hop limit	|
3.		source 			address(32*4)			|
4.		destination 		address(32*4)			|

舍弃：报头长度，报文分段，校验和，ip选项字段。

IPv4地址						IPv6地址
组播地址（ 224.0.0.0/4）				IPv6组播地址（FF00::/8）
广播地址						无，只有任播（ anycast）地址
未指定地址为 0.0.0 .0					未指定地址为 ::
回路地址为 127.0.0.1					回路地址为 ::1
公用 IP地址						可汇聚全球单播地址
私有地址（ 10.0.0 .0/8、172.16.0.0/12和192.168.0.0/16）	本地站点地址（ FEC0::/48）
Microsoft自动专用IP寻址自动配置的地址（169.254.0.0/16）	本地链路地址（ FE80::/64）
表达方式：点分十进制					表达方式：冒号十六进制式（取消前置零、零压缩）
子网掩码表示：以点阵十进制表示法或前缀长度表示法(CIDR)	子网掩码表示：仅使用前缀长度表示法（ CIDR）

IPv6地址作用域和地址分类
•  IPv6地址指定给接口，一个接口可以指定多个地址。
•  IPv6地址有作用域：
	link local地址 本链路有效
	site local地址 本区域（站点）内有效，一个site通常是个校园网
	global地址 全球有效，即可汇聚全球单播地址
•  IPv6地址分类：
	unicast 单播（单点传送）地址
	multicast 组播（多点传送）地址
	anycast 任播（任意点传送）地址
	IPv6没有定义广播地址，其功能由组播地址替代

常见的IPv6地址及其前缀
•  ::/128  即0:0:0:0:0:0:0:0，只能作为尚未获得正式地址的主机的源地址，不能作为
   目的地址，不能分配给真实的网络接口。
•  ::1/128 即0:0:0:0:0:0:0:1，回环地址，相当于IPv4中的localhost（127.0.0.1），
   ping locahost可得到此地址。
•  2001::/16  全球可聚合地址，由IANA 按地域和ISP进行分配，是最常用的IPv6地址属
   于单播地址。
•  2002::/16  6 to 4 地址，用于6to4自动构造隧道技术的地址，属于单播地址。
•  3ffe::/16  早期开始的IPv6 6bone试验网 地址，属于单播地址。
•  fe80::/10  本地链路地址，用于单一链路，适用于自动配置、邻机发现等，路由器不
   转发以fe80开头的地址。
•  ff00::/8   组播地址。
•  ::A.B.C.D  兼容IPv4的IPv6地址，其中<A.B.C.D>代表IPv4地址.自动将IPv6包以隧道
   方式在IPv4网络中传送的IPv4/IPv6节点将使用这些地址。
•  ::FFFF:A.B.C.D   是IPv4映射过来的IPv6地址，其中<A.B.C.D>代表IPv4地址，例如 
   ::ffff:202.120.2.30 ，它是在不支持IPv6的网上用于表示IPv4节点。

IPv6地址的自动配置
	本地链路上的路由器在路由器通告报文中发送网络相关信息（如本地链路的前缀
缺省路由等），主机收到后会根据本地接口自身的接口标识符组合成主机地址，从而完成
自动配置。
	IEEE EUI-64：主机 A 的以太网 MAC 地址是 00-AA-00-3F-2A-1C.首先，通过在
第三个和第四个字节之间插入 FF-FE 将其转换为 EUI-64 格式，其结果是 00-AA-00-FF-
FE-3F-2A-1C。然后，对 U/L 位（第一个字节中的第七位）求反。第一个字节的二进制形
式为 00000000。将第七位求反后，变为 00000010 (0x02)。最后的结果是 02-AA-00-FF-
FE-3F-2A-1C，当转换为冒号十六进制符号时，成为接口标识 2AA:FF:FE3F:2A1C。结果是
对应于 MAC 地址 00-AA-00-3F-2A-1C 的网络适配器的链接本地地址是 FE80::2AA:FF:FE
3F:2A1C。

流：
	一条流由源地址、目的地址和流标签三个域唯一确定。值为0 的流标签标识报文
不属于任何流。源节点设定的流标签值在传输中不能改变，如果IPv6节点没有提供针对流
的特殊处理，则必须在接收或转发时忽略该域。源节点必须保证当前使用的流标签不被重
用，源节点应按一定的顺序（递增或伪随机）分配新的流标签，并在系统重启时选定不同
的初始值。为支持针对特定流的处理，在源和目的节点路径上全部节点或部分节点必须记
录流状态。

keywords:接口，节点，地址

IPv6单播地址:
	IPv6单播地址标识了一个接口，由于每个接口属于一个节点，因此每个节点的任
何接口上的单播地址都可以标识这个节点。发往发往单播地址的报文，由此地址标识的接
口接收。每个接口上至少要有一个链路本地单播地址，另外还可分配任何类型（单播、泛
播和多播）或范围的IPv6地址。

	所有格式前缀不是多播格式前缀（11111111）的IPv6地址都是IPv6单播格式（泛
播和IPv6单播格式相同）。IPv6单播地址和IPv4单播地址一样可聚合。目前定义了多种IP
v6单播地址格式，包括可聚合全球单播地址、NSAP 地址、IPX层次地址、站点本地地址、
链路本地地址和具有IPv4能力的主机地址（嵌入IPv4地址的IPv6地址）。目前广泛使用的
是可聚合全球单播地址、站点本地地址和链路本地地址。

		n bits		128-n bits
	subnet 		prefix	| interface ID		|

	
	IPv6 单播地址由子网前缀和接口ID两部分组成。子网前缀由IANA、ISP和各组织
分配。 接口标识符目前定义为64 比特，可以由本地链路标识生成或采用随机算法生成以
保证唯一性。

IPv6泛播地址:
	IPv6泛播地址格式和IPv6单播地址相同，用来标识一组接口的地址。一般这些接
口属于不同的节点。发往泛播地址的报文被送到这组接口中与其最近的接口（由使用的路
由协议判断哪个是最近的）。
	IPv6泛播地址的用途之一是用来标识属于同一提供因特网服务的组织的一组路由
器。这些地址可在IPv6路由头中作为中间转发路由器，以使报文能够通过特定一组路由器
进行转发。另一个用途就是标识特定子网的一组路由器，报文只要被其中一个路由器接收
即可。
	其中有些泛播地址是已经定义好的，子网路由器泛播地址。

		n bits		128-n bits
	subnet 		prefix	|    0000000	|

	子网路由器器泛播地址中“subnet prefix” 域用来标识特定链路。发送到子网路
由器泛播地址的报文会被送到子网中的一个路由器。所有路由器都必须支持子网泛播地址
	子网路由器泛播地址用于节点需要和远端子网上所有路由器中的一个（不关心具
体是哪一个）通信时使用。例如，一个移动节点需要和它的“家乡”子网上的所有移动代理
中的一个进行通信。

IPv6多播地址格式定义:
	IPv6多播地址用来标识一组接口，一般这些接口属于不同的节点。一个节点可能
属于0到多个多播组。发往多播地址的报文被多播地址标识的所有接口接收。

	8 bits	   4 bits  4 bits 	112 bits
	111111111| flags | scope |	group ID	|
flag:
	0 0 0 T
	T = 0表示为永久分配（“公认“）多播地址（由IANA分配）
	T = 1表示为临时多播地址

scope：用来标记此多播组的应用范围
	0 reserved
	1 node-local scope //只在节点范围内有效
	2 link-local scope //只在链路范围有效
	3-4 unassigned
	5 site-local scope //只在一个站点（网络）有效
	6-7 unassigned
	8 organization-local scope //只在组织内有效
	9-D unassigned
	E global scope	   //全局有效
	F reserved
group ID:
	标识多播（可能是永久的，也可能是临时的，范围有scope定义）。

IPv6永久分配的多播地址
目前的永久分配（“周知”）多播组如下：
(1)        保留的多播地址：
              FF00::～FF0F::        (共16个地址)
(2)        所有节点的地址
              FF01:0:0:0:0:0:0:1   （节点本地）
              FF02:0:0:0:0:0:0:1   （链路本地）
(3)        所有路由器地址
              FF01:0:0:0:0:0:0:2   （节点本地）
              FF02:0:0:0:0:0:0:2   （链路本地）
              FF05:0:0:0:0:0:0:2   （站点本地）
(4)        被请求节点的地址
              FF02:0:0:0:0:1:FFXX:XXXX
	上述地址由被请求节点的单播或泛播地址形成：取被请求节点单播或泛播地址的
低24比特，在前面增加前缀FF02:0:0:0:0:1:FF00::/104构成。例如，和IPv6 地址4037::
01:800:200E:8C6C对应的被请求节点多播地址是FF02::1:FF0E:8C6C。
	此地址用在IPv6邻居发现协议中，用在邻居请求报文中，由于只有后24比特单播
地址相同的节点才会接收目的地址为此地址的报文，因此减少了通信流量（和IPv4 ARP相
比）。

地址分配策略：
	3    13    13       19       16          64 bits
	FP|TLA ID|Sub-TLA| NLA ID | SLA ID |	interface ID	|

	FP:格式前缀，对于可聚合全局单播固定001.
	TLA ID：顶级聚合标识符。此域由IANA分配给指定的注册机构
	SUB-TLA：次顶级聚合标识符。此域向IANA 注册的机构位满足一定条件的组织分
		配。这些组织一般是具有一定规模的ISP。
	NLA ID:下一即聚合标识符。此域由地址注册机构旗下分配了Sub-TLA的组织分配
	SLA ID：站点级聚合标识符。此域一般为组织或企业内部进行子网划分使用。

IANA指定的注册机构则从地址空间2001::/16分配/23前缀，具体如下：
	2001:0200::/23 到 2001:0C00::/23 分配给亚太地区（APNIC）
	2001:0400::/23 分配给美国(ARIN)
	2001:0600::/23到2001:0800::/23 分配给欧洲和中东(RIPE NCC)

IPv6基本功能
IPv6基本功能包括IPv6邻居发现协议（邻居发现、路由器发现、无状态地址自动配置、重定向）、IPv6路径MTU发现以及IPv6域名解析。其中路由器发现和无状态地址自动配置是IPv6的新增功能，邻居发现功能类似于IPv4 ARP，但做了改进和增强。

邻居请求
	当一个节点需要得到同一本地链路上另外一个节点的链路本地地址时，就会发送
邻居请求报文。此报文类似于IPv4中的ARP 请求报文，不过使用多播地址而不使用广播，
只有被请求节点的最后24比特和此组播相同的节点才会收到此报文，减少了广播风暴的可
能。
	源节点使用目的节点的IPv6地址的最右24比特形成相应的多播地址，然后在相应
链路上发送ICMPv6类型为135的报文。目的节点在响应报文中填充其链路地址。为了发送邻居请求报文，源节点必须首先知道目的节点的IPv6地址。
	邻居请求报文也用来在邻居的链路层地址已知时验证邻居的可达性。
